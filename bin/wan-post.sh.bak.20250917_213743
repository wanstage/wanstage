#!/usr/bin/env bash
set -Eeuo pipefail

VENV="$HOME/WANSTAGE/.venv"
. "$VENV/bin/activate"
PY="$VENV/bin/python"
PIP="$VENV/bin/pip"

# ここは “運用に必要最小限” の依存だけ
REQS=(requests gspread google-auth google-auth-oauthlib python-dotenv)
for m in "${REQS[@]}"; do
  "$PY" -c "import importlib; importlib.import_module('$m')" 2>/dev/null \
  || "$PIP" install -q "$m"
done

# 本処理（必要に応じて変更）
exec "$PY" scripts/full_auto_post_flow.py
